<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keka Pro - Work Hours Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,400;0,500;0,600;0,700;0,800;1,700;1,800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0c0e1a;
    --card: #141627;
    --card-border: #1e2140;
    --accent: #7c6bf5;
    --accent-light: #a78bfa;
    --accent-glow: rgba(124, 107, 245, 0.3);
    --green: #34d399;
    --green-glow: rgba(52, 211, 153, 0.15);
    --orange: #fbbf24;
    --red: #f87171;
    --text: #eef0ff;
    --text-dim: #8b8db0;
    --text-muted: #494b6e;
    --radius: 21px;
    --radius-sm: 14px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Plus Jakarta Sans', sans-serif;
    min-height: 100vh;
    padding: 32px 40px;
    overflow-x: hidden;
  }

  /* â”€â”€â”€ Header â”€â”€â”€ */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 36px;
  }

  .header-left h1 {
    font-size: 26px;
    font-weight: 800;
    font-style: italic;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .badge {
    font-size: 10px;
    font-weight: 700;
    font-style: normal;
    letter-spacing: 1.2px;
    background: var(--accent);
    color: #fff;
    padding: 4px 10px;
    border-radius: 6px;
  }

  .greeting {
    font-size: 14px;
    color: var(--text-dim);
    margin-top: 4px;
  }

  .theme-toggle {
    width: 36px; height: 36px; border-radius: 50%;
    background: var(--card); border: 1px solid var(--card-border);
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; cursor: pointer; transition: border-color 0.3s;
  }
  .theme-toggle:hover { border-color: var(--accent); }

  /* â”€â”€â”€ Main Layout â”€â”€â”€ */
  .main {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    align-items: start;
  }

  @media (max-width: 860px) {
    body { padding: 20px 16px; }
    .main { grid-template-columns: 1fr; }
    .stat-row { grid-template-columns: 1fr !important; }
  }

  /* â”€â”€â”€ Panel â”€â”€â”€ */
  .panel {
    background: var(--card);
    border: 1px solid var(--card-border);
    border-radius: var(--radius);
    padding: 28px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* â”€â”€â”€ Hour Tabs â”€â”€â”€ */
  .hour-tabs { display: flex; gap: 10px; }

  .hour-tab {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px; font-weight: 600; letter-spacing: 0.5px;
    padding: 10px 24px; border-radius: 10px;
    border: 1px solid var(--card-border);
    background: transparent; color: var(--text-dim);
    cursor: pointer; transition: all 0.25s;
  }

  .hour-tab.active {
    background: var(--accent); color: #fff;
    border-color: var(--accent);
    box-shadow: 0 4px 20px var(--accent-glow);
  }

  .hour-tab:not(.active):hover { border-color: #3a3d60; color: var(--text); }

  /* â”€â”€â”€ Textarea â”€â”€â”€ */
  textarea {
    width: 100%; height: 170px;
    background: var(--bg); border: 1px solid var(--card-border);
    border-radius: var(--radius-sm); color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px; line-height: 1.8;
    padding: 18px 20px; resize: none; outline: none;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  textarea::placeholder { color: var(--text-muted); font-size: 13px; }
  textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }

  .clear-btn {
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 13px; font-weight: 600;
    color: var(--green); background: none; border: none;
    cursor: pointer; align-self: flex-start; padding: 0;
    transition: opacity 0.2s;
  }
  .clear-btn:hover { opacity: 0.7; }

  /* â”€â”€â”€ Sessions â”€â”€â”€ */
  .session-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 14px 0; border-top: 1px solid var(--card-border);
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px; color: var(--text-dim);
  }
  .session-row:first-child { border-top: none; }
  .session-time { color: var(--text); font-weight: 500; }

  .session-dur {
    font-size: 12px; font-weight: 600; color: var(--green);
    padding: 4px 12px; border-radius: 8px;
    white-space: nowrap;
  }

  .session-dur.ongoing {
    background: rgba(124, 107, 245, 0.12);
    border: 1px solid var(--accent);
    color: var(--accent-light);
    text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;
  }

  .session-footer {
    text-align: center; font-size: 12px; color: var(--text-muted);
    padding-top: 12px; border-top: 1px solid var(--card-border);
  }
  .session-footer .count { color: var(--text-dim); font-weight: 600; }
  .session-footer .dot-live {
    display: inline-block; width: 7px; height: 7px; border-radius: 50%;
    background: var(--green); margin: 0 4px; vertical-align: middle;
    box-shadow: 0 0 6px var(--green); animation: pulse 1.5s ease infinite;
  }

  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

  /* â”€â”€â”€ Right Panel â”€â”€â”€ */
  .right-panel { display: flex; flex-direction: column; gap: 24px; }

  .progress-card {
    background: var(--card); border: 1px solid var(--card-border);
    border-radius: var(--radius); padding: 40px 28px 32px;
    display: flex; flex-direction: column; align-items: center; gap: 24px;
  }

  /* â”€â”€â”€ Ring â”€â”€â”€ */
  .ring-wrapper { position: relative; width: 220px; height: 220px; }
  .ring-wrapper svg { transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: #1e2140; stroke-width: 14; }

  .ring-fill {
    fill: none; stroke-width: 14; stroke-linecap: round;
    transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1), stroke 0.5s;
    filter: drop-shadow(0 0 10px var(--accent-glow));
  }

  .ring-center {
    position: absolute; inset: 0;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }

  .ring-percent {
    font-family: 'JetBrains Mono', monospace;
    font-size: 44px; font-weight: 700; color: var(--text); line-height: 1;
  }

  .ring-badge {
    margin-top: 8px; font-size: 10px; font-weight: 700;
    letter-spacing: 1.5px; text-transform: uppercase;
    padding: 4px 14px; border-radius: 20px;
    display: flex; align-items: center; gap: 5px;
  }

  .ring-badge .bdot { width: 6px; height: 6px; border-radius: 50%; }

  /* â”€â”€â”€ Stat Boxes â”€â”€â”€ */
  .stat-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; width: 100%; }

  .stat-box {
    background: var(--bg); border: 1px solid var(--card-border);
    border-radius: var(--radius-sm); padding: 16px; text-align: center;
  }

  .stat-box-label {
    font-size: 10px; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase; color: var(--text-muted); margin-bottom: 8px;
  }

  .stat-box-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 18px; font-weight: 700; color: var(--text);
  }

  /* â”€â”€â”€ Leave Card â”€â”€â”€ */
  .leave-card {
    background: var(--bg); border: 1px solid var(--card-border);
    border-radius: var(--radius-sm); padding: 18px 24px;
    display: flex; align-items: center; justify-content: space-between; width: 100%;
  }

  .leave-label {
    font-size: 12px; color: var(--text-muted); font-weight: 600;
    text-transform: uppercase; letter-spacing: 0.8px;
  }

  .leave-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 20px; font-weight: 700; color: var(--green);
  }

  /* â”€â”€â”€ Status Banner â”€â”€â”€ */
  .status-banner {
    width: 100%; border-radius: var(--radius-sm);
    padding: 28px 24px; text-align: center;
    font-size: 24px; font-weight: 800; color: #fff;
    background: linear-gradient(135deg, #059669, #34d399, #fbbf24);
    background-size: 200% 200%;
    animation: gradient-shift 4s ease infinite;
    opacity: 0; transform: translateY(8px);
    transition: opacity 0.5s, transform 0.5s;
  }

  .status-banner.visible { opacity: 1; transform: translateY(0); }

  .status-banner.working {
    background: linear-gradient(135deg, #4338ca, var(--accent), #a78bfa);
    background-size: 200% 200%;
  }

  .status-banner.almost {
    background: linear-gradient(135deg, #d97706, #fbbf24, #fde68a);
    background-size: 200% 200%;
  }

  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* â”€â”€â”€ Empty State â”€â”€â”€ */
  .empty-state {
    display: flex; flex-direction: column; align-items: center;
    justify-content: center; min-height: 200px;
    color: var(--text-muted); font-size: 14px; text-align: center; gap: 8px;
  }
  .empty-state span { font-size: 36px; }

  /* â”€â”€â”€ Toast â”€â”€â”€ */
  .toast {
    position: fixed; bottom: 28px; right: 28px;
    background: linear-gradient(135deg, #1a1d38, #252860);
    border: 1px solid var(--green); border-radius: 16px;
    padding: 20px 24px; display: flex; align-items: center; gap: 14px;
    box-shadow: 0 8px 40px rgba(52, 211, 153, 0.2);
    z-index: 1000;
    transform: translateX(calc(100% + 40px)); opacity: 0;
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s;
    max-width: 400px;
  }

  .toast.show { transform: translateX(0); opacity: 1; }
  .toast-icon { font-size: 32px; animation: bounce 0.6s ease infinite alternate; }

  @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-6px); } }

  .toast-content { flex: 1; }

  .toast-title {
    font-size: 15px; font-weight: 700; color: var(--green); margin-bottom: 4px;
  }

  .toast-msg { font-size: 13px; color: var(--text-dim); }

  .toast-close {
    background: none; border: none; color: var(--text-muted);
    font-size: 18px; cursor: pointer; padding: 4px; line-height: 1;
    transition: color 0.2s;
  }
  .toast-close:hover { color: var(--text); }

  .toast-progress {
    position: absolute; bottom: 0; left: 16px; right: 16px;
    height: 3px; border-radius: 3px;
    background: var(--card-border); overflow: hidden;
  }

  .toast-progress-bar {
    height: 100%; background: var(--green); border-radius: 3px;
    animation: shrink 5s linear forwards;
  }

  @keyframes shrink { from { width: 100%; } to { width: 0%; } }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-left">
    <h1>Keka Pro <span class="badge">ULTRA</span></h1>
    <div class="greeting" id="greeting">Good Morning! â˜€ï¸</div>
  </div>
  <div class="theme-toggle">ğŸŒ™</div>
</div>

<!-- Main -->
<div class="main">

  <!-- Left Panel -->
  <div style="display:flex;flex-direction:column;gap:24px;">
    <div class="panel">
      <div class="hour-tabs">
        <button class="hour-tab active" onclick="setTarget(this, 8.5)">8.5 HRS</button>
        <button class="hour-tab" onclick="setTarget(this, 7.5)">7.5 HRS</button>
        <button class="hour-tab" onclick="setTarget(this, 4.5)">4.5 HRS</button>
      </div>

      <textarea id="entries" oninput="calculate()" placeholder="Paste your Keka punch entries here...
9:53:15 AM
12:54:36 PM
1:17:25 PM
2:58:48 PM"></textarea>

      <button class="clear-btn" onclick="clearAll()">Clear &amp; Reset</button>
    </div>

    <div class="panel" id="sessionsPanel" style="display:none;">
      <div id="sessionsArea"></div>
      <div class="session-footer" id="sessionFooter"></div>
    </div>
  </div>

  <!-- Right Panel -->
  <div class="right-panel">
    <div class="progress-card">
      <div id="ringArea">
        <div class="empty-state"><span>ğŸ“Š</span>Paste entries to see progress</div>
      </div>

      <div class="stat-row" id="statRow" style="display:none;">
        <div class="stat-box">
          <div class="stat-box-label">Total Worked</div>
          <div class="stat-box-value" id="valWorked">0h 00m</div>
        </div>
        <div class="stat-box">
          <div class="stat-box-label">Remaining</div>
          <div class="stat-box-value" id="valRemaining">8h 30m</div>
        </div>
        <div class="stat-box">
          <div class="stat-box-label">Total Break</div>
          <div class="stat-box-value" id="valBreak">0h 00m</div>
        </div>
      </div>

      <div class="leave-card" id="leaveCard" style="display:none;">
        <div class="leave-label">ğŸšª You Can Leave At</div>
        <div class="leave-value" id="leaveValue">â€”</div>
      </div>

      <div class="status-banner" id="statusBanner">Keep Going!</div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <div class="toast-icon">ğŸ‰</div>
  <div class="toast-content">
    <div class="toast-title">àªµàª¯à«‹ àªœàª¾ àªµàª¯à«‹ àªœàª¾ àª–àªšàª° àª–àªšàª°</div>
    <div class="toast-msg">Your shift is done! Time to leave ğŸš€</div>
  </div>
  <button class="toast-close" onclick="hideToast()">âœ•</button>
  <div class="toast-progress"><div class="toast-progress-bar"></div></div>
</div>

<script>
let TARGET_MINUTES = 8 * 60 + 30;
let toastTimeout = null;

// Dynamic greeting
(function() {
  const h = new Date().getHours();
  const el = document.getElementById('greeting');
  if (h < 12) el.textContent = 'Good Morning! â˜€ï¸';
  else if (h < 17) el.textContent = 'Good Afternoon! ğŸŒ¤ï¸';
  else el.textContent = 'Good Evening! ğŸŒ™';
})();

function setTarget(btn, hours) {
  document.querySelectorAll('.hour-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  TARGET_MINUTES = hours * 60;
  calculate();
}

function showToast() {
  const toast = document.getElementById('toast');
  const bar = toast.querySelector('.toast-progress-bar');
  bar.style.animation = 'none';
  bar.offsetHeight;
  bar.style.animation = 'shrink 5s linear forwards';
  toast.classList.add('show');
  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(() => hideToast(), 5000);
}

function hideToast() {
  document.getElementById('toast').classList.remove('show');
  clearTimeout(toastTimeout);
}

function parseTime(str) {
  str = str.trim();
  if (!str) return null;
  const match = str.match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?\s*(AM|PM)?$/i);
  if (!match) return null;
  let [, h, m, s, period] = match;
  h = parseInt(h); m = parseInt(m); s = parseInt(s || 0);
  if (period) {
    period = period.toUpperCase();
    if (period === 'AM' && h === 12) h = 0;
    if (period === 'PM' && h !== 12) h += 12;
  }
  return h * 3600 + m * 60 + s;
}

function secToHM(sec) {
  sec = Math.abs(sec);
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  return h + 'h ' + String(m).padStart(2, '0') + 'm';
}

function secToTime12(sec) {
  let h = Math.floor(sec / 3600);
  let m = Math.floor((sec % 3600) / 60);
  const period = h >= 12 ? 'PM' : 'AM';
  h = h % 12 || 12;
  return h + ':' + String(m).padStart(2, '0') + ' ' + period;
}

function fmtShort(sec) {
  let h = Math.floor(sec / 3600);
  let m = Math.floor((sec % 3600) / 60);
  let s = sec % 60;
  return h + ':' + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
}

function calculate() {
  const raw = document.getElementById('entries').value.trim();
  if (!raw) { clearAll(); return; }

  const lines = raw.split(/\n/).map(l => l.trim()).filter(Boolean);
  const times = lines.map(parseTime).filter(t => t !== null);
  if (times.length < 1) { clearAll(); return; }

  times.sort((a, b) => a - b);

  const pairs = [];
  let completedWork = 0;
  let totalBreak = 0;
  const now = new Date();
  const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
  let ongoing = false;
  let ongoingStart = 0;

  for (let i = 0; i < times.length; i += 2) {
    const inTime = times[i];
    let outTime = times[i + 1];
    if (outTime !== undefined) {
      pairs.push({ in: inTime, out: outTime, dur: outTime - inTime });
      completedWork += outTime - inTime;
    } else {
      ongoing = true;
      ongoingStart = inTime;
      const elapsed = nowSec - inTime;
      pairs.push({ in: inTime, out: null, dur: elapsed > 0 ? elapsed : 0 });
    }
  }

  // Calculate breaks
  for (let i = 1; i < pairs.length; i++) {
    const prevOut = pairs[i - 1].out;
    if (prevOut !== null) totalBreak += pairs[i].in - prevOut;
  }

  const ongoingElapsed = ongoing ? Math.max(nowSec - ongoingStart, 0) : 0;
  const totalWorked = completedWork + ongoingElapsed;
  const targetSec = TARGET_MINUTES * 60;
  const percent = Math.min((totalWorked / targetSec) * 100, 100);
  const remaining = targetSec - totalWorked;

  let leaveTime = null;
  const remainingFromCompleted = targetSec - completedWork;
  if (ongoing && remainingFromCompleted > 0) {
    leaveTime = ongoingStart + remainingFromCompleted;
  } else if (!ongoing && remaining > 0) {
    leaveTime = nowSec + remaining;
  }

  // â”€â”€ Ring â”€â”€
  const r = 95;
  const circ = 2 * Math.PI * r;
  const offset = circ - (percent / 100) * circ;

  let ringColor = 'var(--accent)';
  if (percent >= 100) ringColor = 'var(--green)';
  else if (percent >= 75) ringColor = 'var(--accent)';
  else if (percent >= 50) ringColor = 'var(--orange)';
  else ringColor = 'var(--red)';

  let badgeText, badgeBg, badgeColor;
  if (percent >= 100) {
    badgeText = 'COMPLETE'; badgeBg = 'rgba(52,211,153,0.15)'; badgeColor = '#34d399';
  } else if (ongoing) {
    badgeText = 'ACTIVE'; badgeBg = 'rgba(52,211,153,0.12)'; badgeColor = '#34d399';
  } else {
    badgeText = 'PAUSED'; badgeBg = 'rgba(251,191,36,0.12)'; badgeColor = '#fbbf24';
  }

  const dotAnim = ongoing && percent < 100 ? 'box-shadow:0 0 6px var(--green);animation:pulse 1.5s ease infinite;' : '';

  document.getElementById('ringArea').innerHTML = `
    <div class="ring-wrapper">
      <svg width="220" height="220" viewBox="0 0 220 220">
        <circle class="ring-bg" cx="110" cy="110" r="${r}"/>
        <circle class="ring-fill" cx="110" cy="110" r="${r}"
          stroke="${ringColor}" stroke-dasharray="${circ}" stroke-dashoffset="${offset}"/>
      </svg>
      <div class="ring-center">
        <div class="ring-percent">${Math.round(percent)}%</div>
        <div class="ring-badge" style="background:${badgeBg};color:${badgeColor}">
          <span class="bdot" style="background:${badgeColor};${dotAnim}"></span>
          ${badgeText}
        </div>
      </div>
    </div>`;

  // â”€â”€ Stats â”€â”€
  document.getElementById('statRow').style.display = 'grid';
  document.getElementById('valWorked').textContent = secToHM(totalWorked);
  document.getElementById('valRemaining').textContent = remaining <= 0 ? '0h 00m' : secToHM(remaining);
  document.getElementById('valBreak').textContent = secToHM(totalBreak);

  // â”€â”€ Leave â”€â”€
  const leaveCard = document.getElementById('leaveCard');
  leaveCard.style.display = 'flex';
  const leaveStr = remaining <= 0 ? 'Now! ğŸ‰' : (leaveTime && leaveTime < 86400 ? secToTime12(leaveTime) : 'â€”');
  document.getElementById('leaveValue').textContent = leaveStr;

  // â”€â”€ Banner â”€â”€
  const banner = document.getElementById('statusBanner');
  banner.classList.add('visible');
  if (percent >= 100) {
    banner.textContent = 'Done for Today ğŸ‰';
    banner.className = 'status-banner visible';
  } else if (percent >= 75) {
    banner.textContent = 'Almost There! ğŸ”¥';
    banner.className = 'status-banner visible almost';
  } else {
    banner.textContent = 'Keep Going! ğŸ’ª';
    banner.className = 'status-banner visible working';
  }

  // â”€â”€ Sessions â”€â”€
  const sp = document.getElementById('sessionsPanel');
  const sa = document.getElementById('sessionsArea');
  const sf = document.getElementById('sessionFooter');
  sp.style.display = 'flex';
  sa.innerHTML = '';

  pairs.forEach(p => {
    const row = document.createElement('div');
    row.className = 'session-row';
    const inStr = fmtShort(p.in);
    const outStr = p.out !== null ? fmtShort(p.out) : 'Currently Working';
    const dur = p.out !== null
      ? `<span class="session-dur">+ ${secToHM(p.dur)}</span>`
      : `<span class="session-dur ongoing">+ ${secToHM(p.dur)}</span>`;
    row.innerHTML = `<span class="session-time">${inStr} â†’ ${outStr}</span>${dur}`;
    sa.appendChild(row);
  });

  const liveStatus = ongoing && percent < 100
    ? '<span class="dot-live"></span> Currently Working'
    : 'âœ… All sessions closed';
  sf.innerHTML = `<span class="count">${pairs.length} session${pairs.length > 1 ? 's' : ''}</span> Â· ${liveStatus}`;

  // â”€â”€ Toast â”€â”€
  if ((leaveTime !== null && leaveTime < 86400 && nowSec >= leaveTime) || percent >= 100) {
    showToast();
  } else {
    hideToast();
  }
}

function clearAll() {
  document.getElementById('entries').value = '';
  document.getElementById('ringArea').innerHTML = '<div class="empty-state"><span>ğŸ“Š</span>Paste entries to see progress</div>';
  document.getElementById('statRow').style.display = 'none';
  document.getElementById('leaveCard').style.display = 'none';
  document.getElementById('statusBanner').classList.remove('visible');
  document.getElementById('sessionsPanel').style.display = 'none';
  hideToast();
}
</script>
</body>
</html>
